#!/usr/bin/env php
<?php

function _pake_bin_init()
{
    $loaded = false;

    if (file_exists('composer.json')) {
        // looks like we are installed as dependency via composer
        $data = json_decode(file_get_contents('composer.json'), true);

        if (isset($data['config']['vendor-dir'])) {
            $vendor_dir = $data['config']['vendor-dir'];
        } else {
            $vendor_dir = 'vendor';
        }

        $autoload_file = $vendor_dir . '/autoload.php';

        if (file_exists($autoload_file)) {
            require_once($autoload_file);
            $loaded = true;
        }
    }

    if (!$loaded and is_dir($__DIR__. '/../vendor') and file_exists($__DIR__. '/../vendor/autoload.php')) {
        // looks like we are in composer dev-environment
        require_once(realpath($__DIR__. '/..').'/vendor/autoload.php');
        $loaded = true;
    }

    if (!$loaded) {
        // fallback to custom autoloader
        require_once('../lib/pake/autoload.php');
        $loaded = true;
    }

    require_once('../lib/pake/cli_init.php');

    $retval = pakeApp::get_instance()->run();

    if (false === $retval) {
        exit(1);
    }
}

_pake_bin_init();
